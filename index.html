<!DOCTYPE html>
<html>

<head>
  <title>Smart Campus Navigation System</title>
</head>

<body>
  <h1>Smart Campus Navigation System</h1>

  <div id="Destination">
    <h2>Destination</h2>
    <form action="index.php" method="post">
      <input id="search-box" type="text" placeholder="Search for a place...">
<!--      <label for="destination"></label>-->
<!--      <input type="text" id="destination" name="destination" required>-->
<!--      <input type="submit" value="Submit">-->
    </form>
  </div>

  <div id="map">
    <!-- Map will be shown here -->
  </div>




  <script>
    var lat = 0;
    var lng = 0;
    function initMap() {
      var mapOptions = {
        center: { lat: 43.77334654509587, lng: -79.50236757866836 },
        zoom: 17
      };
      var map = new google.maps.Map(document.getElementById('map'), mapOptions);
    }

    // search bar
    const input = document.getElementById("search-box");
    const searchBox = new google.maps.places.SearchBox(input);

    // bias the searchbox result towards the map's viewpoint
    map.addListener("bounds_changed", () => {
      searchBox.setBounds(map.getBounds());
    });

    // array to hold markers
    const markers = [];

    // listen for event fired when a user selects a prediction and retrieve details.
    searchBox.addListener("places_changed", () => {
      const places = searchBox.getPlaces();

      if(!places || places.length === 0){
        alert("No specific location found.");
        return;
      }

      // clear out previous maker
      markers.forEach(marker => marker.setMap(null));
      markers.length = 0;

      // fit map bounds to search result
      const bounds = new google.maps.LatLngBounds();

      places.forEach(place => {
        if (!place.geometry || !place.geometry.location) {
          console.log("Place does not have a valid location.");
          return;
        }

        // Add a marker for each place
        const marker = new google.maps.Marker({
          map: map,
          title: place.name,
          position: place.geometry.location,
        });
        markers.push(marker);

        // Adjust map bounds
        if (place.geometry.viewport) {
          bounds.union(place.geometry.viewport);
        } else {
          bounds.extend(place.geometry.location);
        }
      });

      map.fitBounds(bounds);
    })
    window.onload = initMap;


    var destination = sds;
    var geocoder = new google.maps.Geocoder();
    var address = destination; //'1600 Amphitheatre Parkway, Mountain View, CA'

    geocoder.geocode({ 'address': address }, function (results, status) {
      if (status === 'OK') {
        var location = results[0].geometry.location;
        console.log('Latitude: ' + location.lat());
        console.log('Longitude: ' + location.lng());
      } else {
        console.error('Geocode was not successful for the following reason: ' + status);
      }

      var latlng = { lat: lat, lng: lng };
      geocoder.geocode({ 'location': latlng }, function (results, status) {
        if (status === 'OK') {
          if (results[0]) {
            console.log('Address: ' + results[0].formatted_address);
          } else {
            console.error('No results found');
          }
        } else {
          console.error('Geocode was not successful for the following reason: ' + status);
        }
      });
    });


  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7TDyrwOAf5WE_2-sBc0ktiBIR53CI3bU&callback=initMap"></script>
</body>

</html>

<style>
  #map {
    margin: auto;
    height: 70%;
    width: 70%;
  }

  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
</style>
